import sys,os
import numpy as np
sys.path.append(os.pardir)
from common.functions import *
from common.functions import cross_entropy_error
from common.gradient import numerical_gradient
from dataset.mnist import load_mnist
sys.path.append(".")
from two_layer_net_with_batch import TwoLayerNet

(x_train, t_train), (x_test, t_test) = load_mnist(normalize=True, one_hot_label=True)

train_loss_list = []

# ハイパーパラメータ
iters_num = 10
train_size = x_train.shape[0]
batch_size = 100
learning_rate = 0.1

network = TwoLayerNet(input_size = 784, hidden_size = 50, output_size = 10)

for i in range(iters_num):
    # ミニバッチ
    batch_mask = np.random.choice(train_size, batch_size)
    x_batch = x_train[batch_mask]
    t_batch = t_train[batch_mask]

    grad = network.numerical_gradient(x_batch, t_batch)
    for key in ('W1', 'b1', 'W2', 'b2'):
        network.params[key] -= learning_rate * grad[key]

    loss = network.loss(x_batch, t_batch)
    train_loss_list.append(loss)



# print(grad)
#{'W1': array([[ 0.,  0.,  0., ...,  0.,  0.,  0.],
#       [ 0.,  0.,  0., ...,  0.,  0.,  0.],
#       [ 0.,  0.,  0., ...,  0.,  0.,  0.],
#       ..., 
#       [ 0.,  0.,  0., ...,  0.,  0.,  0.],
#       [ 0.,  0.,  0., ...,  0.,  0.,  0.],
#       [ 0.,  0.,  0., ...,  0.,  0.,  0.]]), 'b1': array([  1.84710456e-04,   9.21505849e-05,   1.68739596e-04,
#        -4.50719084e-05,   1.92791803e-04,  -2.35087616e-05,
#        -4.60473859e-05,   2.01858206e-04,   1.51981179e-04,
#         3.72796394e-05,   2.69098603e-04,  -7.81486431e-05,
#        -7.74254350e-05,   2.24434893e-05,   1.19008048e-04,
#        -1.17019421e-04,  -3.48875817e-05,  -8.80167605e-05,
#        -2.55925947e-06,   1.87003961e-04,   2.00396235e-04,
#         3.64889874e-05,   5.12548048e-05,  -2.40923232e-04,
#         1.63477225e-04,   3.83623977e-05,  -2.98153093e-04,
#        -1.85046833e-04,   1.29170985e-05,   1.04864508e-04,
#         1.33056477e-04,   7.02891345e-05,   1.95083321e-04,
#         2.31268900e-04,   1.23207888e-06,  -8.91319618e-05,
#        -3.12375215e-05,  -1.41012693e-04,  -7.48189644e-05,
#        -3.89568644e-05,   1.71540349e-04,   2.93722247e-05,
#         2.52337795e-05,  -2.48971930e-04,  -1.43604433e-04,
#         2.23121033e-05,   3.04154359e-04,   1.83319702e-04,
#        -1.11432974e-04,  -9.14380305e-05]), 'W2': array([[  8.84605623e-03,  -2.73722350e-03,   1.17478361e-02,
#         -8.22317366e-03,  -1.88301957e-02,   2.18933057e-03,
#          1.10739048e-02,  -4.20391404e-03,   1.00235614e-03,
#         -8.64976746e-04],
#       [  1.12131925e-02,  -3.01728229e-03,   1.10965807e-02,
#         -8.44344000e-03,  -1.94559351e-02,   2.56831816e-03,
#          1.04798784e-02,  -6.44312612e-03,   3.08489896e-03,
#         -1.08308508e-03],
#       [  8.41779079e-03,  -1.71876897e-03,   1.14688892e-02,
#         -8.80918699e-03,  -1.81426466e-02,   2.14418032e-03,
#          9.96326724e-03,  -5.42857094e-03,   2.60906136e-03,
#         -5.04015290e-04],
#       [  9.95271565e-03,  -2.93567102e-03,   1.22032383e-02,
#         -8.03883488e-03,  -1.72013281e-02,   9.93806821e-04,
#          1.06194753e-02,  -5.64499384e-03,   2.43583423e-03,
#         -2.38424236e-03],
#       [  9.63641150e-03,  -2.05739743e-03,   1.22266208e-02,
#         -9.06558898e-03,  -1.74634132e-02,   1.56227061e-03,
#          1.09354087e-02,  -6.55206980e-03,   1.87231769e-03,
#         -1.09455974e-03],
#       [  8.60682929e-03,  -3.36783196e-03,   1.14826877e-02,
#         -9.01185645e-03,  -1.79035528e-02,   2.26442260e-03,
#          1.16442612e-02,  -6.13818625e-03,   3.28055055e-03,
#         -8.57323721e-04],
#       [  1.00494010e-02,  -3.47628414e-03,   1.08680895e-02,
#         -8.45627509e-03,  -1.74683591e-02,   2.68162665e-03,
#          1.01243563e-02,  -5.55440295e-03,   2.32385278e-03,
#         -1.09200472e-03],
#       [  9.05835494e-03,  -4.70718427e-03,   9.10556620e-03,
#         -8.58139028e-03,  -1.45027850e-02,   2.51515506e-03,
#          1.03161190e-02,  -4.92098626e-03,   1.71020853e-03,
#          6.94218683e-06],
#       [  9.75179605e-03,  -3.64370570e-03,   1.10540061e-02,
#         -9.42953827e-03,  -1.67333251e-02,   3.19340724e-03,
#          1.07741931e-02,  -5.28840173e-03,   1.43571117e-03,
#         -1.11414274e-03],
#       [  1.01729476e-02,  -2.81582061e-03,   1.18085874e-02,
#         -1.02500968e-02,  -1.59555823e-02,   1.53251253e-03,
#          1.04166299e-02,  -5.14266222e-03,   1.38863986e-03,
#         -1.15515530e-03],
#       [  6.95816422e-03,  -1.96101270e-03,   1.12069094e-02,
#         -7.98809792e-03,  -1.82111071e-02,   1.76694231e-03,
#          1.17821283e-02,  -5.18385096e-03,   2.26517421e-03,
#         -6.35249562e-04],
#       [  8.13725915e-03,  -2.27107912e-03,   1.07105701e-02,
#         -7.66256300e-03,  -1.88050693e-02,   2.67740151e-03,
#          1.08296361e-02,  -3.96054824e-03,   2.21063855e-03,
#         -1.86624550e-03],
#       [  9.55828745e-03,  -2.22861340e-03,   1.10530299e-02,
#         -8.42195259e-03,  -1.83431910e-02,   2.49751314e-03,
#          1.03823621e-02,  -4.79691741e-03,   2.13581073e-03,
#         -1.83632873e-03],
#       [  9.37835685e-03,  -4.14296136e-03,   1.01375670e-02,
#         -8.12492714e-03,  -1.69535693e-02,   2.26175083e-03,
#          1.13695158e-02,  -5.37625847e-03,   2.27027759e-03,
#         -8.19751671e-04],
#       [  9.47654936e-03,  -4.02431792e-03,   1.12396232e-02,
#         -9.59211921e-03,  -1.77384417e-02,   3.37901938e-03,
#          1.12688355e-02,  -6.20779990e-03,   2.45256193e-03,
#         -2.53910513e-04],
#       [  9.94011210e-03,  -3.50250334e-03,   1.02534845e-02,
#         -8.69547472e-03,  -1.86689407e-02,   3.59301723e-03,
#          1.14494071e-02,  -5.64510710e-03,   2.04346218e-03,
#         -7.67457078e-04],
#       [  7.85675058e-03,  -3.06861342e-03,   1.05412240e-02,
#         -1.02746014e-02,  -1.65549163e-02,   2.34926783e-03,
#          1.09530725e-02,  -3.52469629e-03,   2.45328871e-03,
#         -7.30775986e-04],
#       [  7.46326450e-03,  -2.49260486e-03,   1.02473947e-02,
#         -8.79775199e-03,  -1.64186832e-02,   1.54990859e-03,
#          1.14988897e-02,  -5.60276978e-03,   3.25558782e-03,
#         -7.03235383e-04],
#       [  8.17563944e-03,  -2.53076291e-03,   1.18019192e-02,
#         -7.99820472e-03,  -1.87919527e-02,   2.50958870e-03,
#          1.18397910e-02,  -5.96423734e-03,   2.51756171e-03,
#         -1.55934221e-03],
#       [  8.18214704e-03,  -4.25864246e-03,   1.18665402e-02,
#         -9.65793061e-03,  -1.61321103e-02,   2.23772402e-03,
#          1.04098581e-02,  -5.35571518e-03,   2.53818977e-03,
#          1.69939531e-04],
#       [  8.02959522e-03,  -3.13317948e-03,   1.04125615e-02,
#         -8.88421740e-03,  -1.68630692e-02,   1.66309656e-03,
#          1.25224251e-02,  -5.28332956e-03,   1.86045892e-03,
#         -3.24341496e-04],
#       [  7.11891229e-03,  -4.29345150e-03,   1.13944756e-02,
#         -8.33997482e-03,  -1.57414074e-02,   9.19716816e-04,
#          1.15170690e-02,  -4.40850231e-03,   2.46144943e-03,
#         -6.28286965e-04],
#       [  9.74888474e-03,  -9.84909394e-04,   1.10839409e-02,
#         -1.04068629e-02,  -1.83003661e-02,   2.66541556e-03,
#          1.24453160e-02,  -6.69910068e-03,   2.04947675e-03,
#         -1.60179474e-03],
#       [  7.90737570e-03,  -1.65795397e-03,   1.14298969e-02,
#         -9.68592459e-03,  -1.74993557e-02,   2.54216403e-03,
#          1.18612216e-02,  -5.38200181e-03,   2.05993954e-03,
#         -1.57536156e-03],
#       [  8.08019793e-03,  -2.68360594e-03,   1.17446681e-02,
#         -1.02789592e-02,  -1.72065462e-02,   2.41456105e-03,
#          1.19197874e-02,  -6.20158603e-03,   2.76777254e-03,
#         -5.56289452e-04],
#       [  8.32616471e-03,  -2.23158972e-03,   1.10110638e-02,
#         -9.84405539e-03,  -1.66807478e-02,   2.74678667e-03,
#          1.06757386e-02,  -4.95308820e-03,   1.49164285e-03,
#         -5.41915350e-04],
#       [  1.03350912e-02,  -4.40353617e-03,   1.12437601e-02,
#         -9.59556274e-03,  -1.78472328e-02,   1.81016950e-03,
#          1.07757236e-02,  -3.88696334e-03,   3.16088156e-03,
#         -1.59233080e-03],
#       [  8.20146264e-03,  -1.88887065e-03,   1.06789365e-02,
#         -7.17652493e-03,  -1.88156974e-02,   2.06972032e-03,
#          1.01872620e-02,  -5.64145509e-03,   2.91479578e-03,
#         -5.29629043e-04],
#       [  7.36772314e-03,  -1.93168924e-03,   1.09947651e-02,
#         -8.11774701e-03,  -1.77851671e-02,   3.14900811e-03,
#          1.19997461e-02,  -6.93031601e-03,   2.21091534e-03,
#         -9.57238295e-04],
#       [  8.46043043e-03,  -9.80749333e-04,   1.07039461e-02,
#         -9.96083866e-03,  -1.92639218e-02,   1.90426383e-03,
#          1.09069898e-02,  -3.84682464e-03,   2.53959018e-03,
#         -4.62885716e-04],
#       [  1.11435814e-02,  -5.46001045e-03,   1.22213482e-02,
#         -1.05627127e-02,  -1.72356575e-02,   2.57169953e-03,
#          1.22266655e-02,  -6.04122322e-03,   2.58379081e-03,
#         -1.44748136e-03],
#       [  8.20985461e-03,  -2.48475920e-03,   9.26527884e-03,
#         -6.87995372e-03,  -1.89448153e-02,   3.37096429e-03,
#          9.78580294e-03,  -4.85296543e-03,   3.16057150e-03,
#         -6.29978409e-04],
#       [  8.62785732e-03,  -2.37843567e-03,   1.08970266e-02,
#         -8.80585829e-03,  -1.71016642e-02,   1.94412746e-03,
#          1.09095635e-02,  -6.18237823e-03,   2.57686173e-03,
#         -4.87100109e-04],
#       [  1.03855790e-02,  -3.07778298e-03,   9.55546359e-03,
#         -7.69513733e-03,  -1.87246108e-02,   3.05595235e-03,
#          9.60746889e-03,  -4.97335701e-03,   2.45176967e-03,
#         -5.85345303e-04],
#       [  7.62598067e-03,  -3.44594250e-03,   1.02380753e-02,
#         -9.03740008e-03,  -1.60491088e-02,   2.89027591e-03,
#          9.88274039e-03,  -4.45897782e-03,   2.95516207e-03,
#         -6.00804966e-04],
#       [  7.88626244e-03,  -2.93991458e-03,   1.17158181e-02,
#         -8.31443630e-03,  -1.66292922e-02,   1.81063591e-03,
#          1.10329784e-02,  -4.78018984e-03,   1.67360372e-03,
#         -1.45546547e-03],
#       [  7.96391201e-03,  -2.57275871e-03,   9.89846237e-03,
#         -1.01341935e-02,  -1.60830889e-02,   1.57995209e-03,
#          1.12103253e-02,  -3.73029840e-03,   1.91478383e-03,
#         -4.70958827e-05],
#       [  7.70869605e-03,  -3.69301822e-03,   1.00509210e-02,
#         -7.13286810e-03,  -1.77792093e-02,   2.99857281e-03,
#          1.06360261e-02,  -5.61297489e-03,   2.73344477e-03,
#          9.04098640e-05],
#       [  1.00344404e-02,  -1.87541196e-03,   9.58241196e-03,
#         -7.92360787e-03,  -1.71114498e-02,   2.80246664e-03,
#          1.14337496e-02,  -6.70656833e-03,   2.03097263e-03,
#         -2.26700311e-03],
#       [  1.03452961e-02,  -2.06336564e-03,   1.11114623e-02,
#         -9.32089204e-03,  -1.74726309e-02,   2.14864703e-03,
#          1.02176560e-02,  -4.16324441e-03,   1.48202504e-03,
#         -2.28495331e-03],
#       [  8.47336567e-03,  -3.93360378e-03,   1.13985795e-02,
#         -9.29465481e-03,  -1.71606476e-02,   2.40276043e-03,
#          1.12665125e-02,  -5.02702224e-03,   3.04193810e-03,
#         -1.16722764e-03],
#       [  8.05128104e-03,  -1.69041269e-03,   1.02927614e-02,
#         -8.22792881e-03,  -1.86344822e-02,   3.37346937e-03,
#          9.06976488e-03,  -5.93205208e-03,   3.52573587e-03,
#          1.71863375e-04],
#       [  7.42907257e-03,  -3.53160259e-03,   1.14104089e-02,
#         -8.19316580e-03,  -1.76832275e-02,   1.78852106e-03,
#          1.14805980e-02,  -3.89649277e-03,   1.36145158e-03,
#         -1.65563299e-04],
#       [  8.04734305e-03,  -3.45460647e-03,   9.90420289e-03,
#         -8.26385787e-03,  -1.67398532e-02,   2.19153951e-03,
#          1.11339339e-02,  -5.31523485e-03,   2.84807301e-03,
#         -3.51539886e-04],
#       [  8.94261581e-03,  -3.11498888e-03,   1.12251776e-02,
#         -7.94283383e-03,  -1.77735774e-02,   1.96444262e-03,
#          1.15385978e-02,  -5.14355064e-03,   1.46194642e-03,
#         -1.15782935e-03],
#       [  8.59199436e-03,  -5.60549279e-03,   1.04921605e-02,
#         -7.49651736e-03,  -1.68867251e-02,   2.07322060e-03,
#          1.15639624e-02,  -5.39426326e-03,   2.68934347e-03,
#         -2.76826517e-05],
#       [  7.28790691e-03,  -1.53794980e-03,   9.38862253e-03,
#         -8.58618334e-03,  -1.75303114e-02,   2.80065478e-03,
#          1.16763738e-02,  -5.95046978e-03,   2.99145939e-03,
#         -5.40102980e-04],
#       [  9.34693001e-03,  -4.05153028e-03,   1.21305616e-02,
#         -1.03325722e-02,  -1.65721114e-02,   1.41618362e-03,
#          1.20896305e-02,  -5.24523889e-03,   1.67365962e-03,
#         -4.55512414e-04],
#       [  9.40335637e-03,  -2.32250287e-03,   1.21906037e-02,
#         -9.26128358e-03,  -1.85221053e-02,   2.25714587e-03,
#          1.13977777e-02,  -6.20150417e-03,   3.40694258e-03,
#         -2.34843017e-03],
#       [  9.59363056e-03,  -2.85934235e-03,   1.07969719e-02,
#         -8.67304334e-03,  -1.82783515e-02,   2.48255233e-03,
#          1.09839669e-02,  -5.88938711e-03,   3.15660448e-03,
#         -1.31360178e-03]]), 'b2': array([  1.84710456e-04,   9.21505849e-05,   1.68739596e-04,
#        -4.50719084e-05,   1.92791803e-04,  -2.35087616e-05,
#        -4.60473859e-05,   2.01858206e-04,   1.51981179e-04,
#         3.72796394e-05,   2.69098603e-04,  -7.81486431e-05,
#        -7.74254350e-05,   2.24434893e-05,   1.19008048e-04,
#        -1.17019421e-04,  -3.48875817e-05,  -8.80167605e-05,
#        -2.55925947e-06,   1.87003961e-04,   2.00396235e-04,
#         3.64889874e-05,   5.12548048e-05,  -2.40923232e-04,
#         1.63477225e-04,   3.83623977e-05,  -2.98153093e-04,
#        -1.85046833e-04,   1.29170985e-05,   1.04864508e-04,
#         1.33056477e-04,   7.02891345e-05,   1.95083321e-04,
#         2.31268900e-04,   1.23207888e-06,  -8.91319618e-05,
#        -3.12375215e-05,  -1.41012693e-04,  -7.48189644e-05,
#        -3.89568644e-05,   1.71540349e-04,   2.93722247e-05,
#         2.52337795e-05,  -2.48971930e-04,  -1.43604433e-04,
#         2.23121033e-05,   3.04154359e-04,   1.83319702e-04,
#        -1.11432974e-04,  -9.14380305e-05])}
#    P
